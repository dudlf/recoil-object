{"version":3,"sources":["../src/index.ts","../src/recoil-object/recoil-object.js","../src/utils/is-object.ts","../src/utils/is-promise.ts"],"sourcesContent":["export * from './recoil-object'","import { atom } from 'recoil'\r\nimport { setRecoil } from 'recoil-nexus'\r\n\r\nimport { isObject } from '../utils/is-object'\r\n\r\nfunction getEffectsSelf(args, parent, propKey) {\r\n  if (parent) {\r\n    return [\r\n      ...(args.options?.['_self']?.effects || []),\r\n      ({ onSet }) => {\r\n        onSet((newValue) => {\r\n          setRecoil(parent, (currVal) => ({\r\n            ...currVal,\r\n            [propKey]: newValue,\r\n          }))\r\n        })\r\n      },\r\n    ]\r\n  }\r\n  return args.options?.['_self']?.effects || []\r\n}\r\n\r\nfunction getEffectsNode(args, propKey, useRootAtom, _self) {\r\n  if (useRootAtom) {\r\n    return [\r\n      ...(args.options?.[propKey]?.effects || []),\r\n      useRootAtom &&\r\n      (({ onSet }) => {\r\n        onSet((newValue) => {\r\n          setRecoil(_self, (currVal) => ({\r\n            ...currVal,\r\n            [propKey]: newValue,\r\n          }))\r\n        })\r\n      }),\r\n    ]\r\n  }\r\n  return args.options?.[atomKey]?.effects || []\r\n}\r\n\r\nfunction createRecoilObject(args, useRootAtom, parent, propKey) {\r\n  const _self = useRootAtom\r\n    ? atom({\r\n      ...args.options?._self,\r\n      key: args.key,\r\n      default: args.default,\r\n      effects: getEffectsSelf(args, parent, propKey),\r\n    })\r\n    : undefined\r\n\r\n  function mapper(e) {\r\n    const [propKey, propVal] = e\r\n\r\n    const atomkey = `${args.key}.${String(propKey)}`\r\n\r\n    if (isObject(propVal)) {\r\n      return [\r\n        propKey,\r\n        createRecoilObject(\r\n          {\r\n            key: atomkey,\r\n            default: propVal,\r\n            options: args.options?.[propKey],\r\n          },\r\n          useRootAtom,\r\n          _self,\r\n          propKey\r\n        ),\r\n      ]\r\n    }\r\n\r\n    return [\r\n      propKey,\r\n      atom({\r\n        ...args.options?.[propKey],\r\n        key: atomkey,\r\n        default: propVal,\r\n        effects: getEffectsNode(args, propKey, useRootAtom, _self),\r\n      }),\r\n    ]\r\n  }\r\n\r\n  function reducer(prev, curr) {\r\n    return {\r\n      ...prev,\r\n      [curr[0]]: curr[1],\r\n    }\r\n  }\r\n\r\n  return Object.entries(args.default)\r\n    .map(mapper)\r\n    .reduce(reducer, useRootAtom ? { _self } : {})\r\n}\r\n\r\nexport function recoilObject(args) {\r\n  return createRecoilObject(args, false)\r\n}\r\n\r\nexport function recoilObjectWithRoot(args) {\r\n  return createRecoilObject(args, true)\r\n}\r\n\r\nexport default {\r\n  recoilObject,\r\n  recoilObjectWithRoot,\r\n}\r\n","import { RecoilLoadable } from 'recoil'\r\nimport { isPromise } from './is-promise'\r\n\r\nexport function isObject(obj: any) {\r\n  return typeof obj === 'object' && !isPromise(obj) && !RecoilLoadable.isLoadable(obj)\r\n}\r\n\r\nexport default {\r\n  isObject,\r\n}\r\n","export function isPromise(obj: any) {\r\n  return !!obj && (typeof obj === 'object' || typeof obj === 'function') && typeof obj.then === 'function'\r\n}\r\n\r\nexport default {\r\n  isPromise,\r\n}\r\n"],"mappings":";;;;;;;;;;;;;;;;;;;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;;;ACAA,qBAAqB;AACrB,0BAA0B;;;ACD1B,oBAA+B;;;ACAxB,mBAAmB,KAAU;AAClC,SAAO,CAAC,CAAC,OAAQ,QAAO,QAAQ,YAAY,OAAO,QAAQ,eAAe,OAAO,IAAI,SAAS;AAChG;;;ADCO,kBAAkB,KAAU;AACjC,SAAO,OAAO,QAAQ,YAAY,CAAC,UAAU,GAAG,KAAK,CAAC,6BAAe,WAAW,GAAG;AACrF;;;ADAA,wBAAwB,MAAM,QAAQ,SAAS;AAL/C;AAME,MAAI,QAAQ;AACV,WAAO;AAAA,MACL,GAAI,kBAAK,YAAL,mBAAe,aAAf,mBAAyB,YAAW,CAAC;AAAA,MACzC,CAAC,EAAE,YAAY;AACb,cAAM,CAAC,aAAa;AAClB,6CAAU,QAAQ,CAAC,YAAa;AAAA,YAC9B,GAAG;AAAA,YACH,CAAC,UAAU;AAAA,UACb,EAAE;AAAA,QACJ,CAAC;AAAA,MACH;AAAA,IACF;AAAA,EACF;AACA,SAAO,kBAAK,YAAL,mBAAe,aAAf,mBAAyB,YAAW,CAAC;AAC9C;AAEA,wBAAwB,MAAM,SAAS,aAAa,OAAO;AAtB3D;AAuBE,MAAI,aAAa;AACf,WAAO;AAAA,MACL,GAAI,kBAAK,YAAL,mBAAe,aAAf,mBAAyB,YAAW,CAAC;AAAA,MACzC,eACC,EAAC,EAAE,YAAY;AACd,cAAM,CAAC,aAAa;AAClB,6CAAU,OAAO,CAAC,YAAa;AAAA,YAC7B,GAAG;AAAA,YACH,CAAC,UAAU;AAAA,UACb,EAAE;AAAA,QACJ,CAAC;AAAA,MACH;AAAA,IACF;AAAA,EACF;AACA,SAAO,kBAAK,YAAL,mBAAe,aAAf,mBAAyB,YAAW,CAAC;AAC9C;AAEA,4BAA4B,MAAM,aAAa,QAAQ,SAAS;AAxChE;AAyCE,QAAM,QAAQ,cACV,yBAAK;AAAA,IACL,GAAG,WAAK,YAAL,mBAAc;AAAA,IACjB,KAAK,KAAK;AAAA,IACV,SAAS,KAAK;AAAA,IACd,SAAS,eAAe,MAAM,QAAQ,OAAO;AAAA,EAC/C,CAAC,IACC;AAEJ,kBAAgB,GAAG;AAlDrB;AAmDI,UAAM,CAAC,UAAS,WAAW;AAE3B,UAAM,UAAU,GAAG,KAAK,OAAO,OAAO,QAAO;AAE7C,QAAI,SAAS,OAAO,GAAG;AACrB,aAAO;AAAA,QACL;AAAA,QACA,mBACE;AAAA,UACE,KAAK;AAAA,UACL,SAAS;AAAA,UACT,SAAS,YAAK,YAAL,oBAAe;AAAA,QAC1B,GACA,aACA,OACA,QACF;AAAA,MACF;AAAA,IACF;AAEA,WAAO;AAAA,MACL;AAAA,MACA,yBAAK;AAAA,QACH,GAAG,WAAK,YAAL,mBAAe;AAAA,QAClB,KAAK;AAAA,QACL,SAAS;AAAA,QACT,SAAS,eAAe,MAAM,UAAS,aAAa,KAAK;AAAA,MAC3D,CAAC;AAAA,IACH;AAAA,EACF;AAEA,mBAAiB,MAAM,MAAM;AAC3B,WAAO;AAAA,MACL,GAAG;AAAA,MACH,CAAC,KAAK,KAAK,KAAK;AAAA,IAClB;AAAA,EACF;AAEA,SAAO,OAAO,QAAQ,KAAK,OAAO,EAC/B,IAAI,MAAM,EACV,OAAO,SAAS,cAAc,EAAE,MAAM,IAAI,CAAC,CAAC;AACjD;AAEO,sBAAsB,MAAM;AACjC,SAAO,mBAAmB,MAAM,KAAK;AACvC;AAEO,8BAA8B,MAAM;AACzC,SAAO,mBAAmB,MAAM,IAAI;AACtC;","names":[]}